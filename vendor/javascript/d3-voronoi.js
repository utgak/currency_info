var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var t={};(function(e,r){r(t)})(t,(function(t){function constant(e){return function(){return e}}function x(e){return e[0]}function y(e){return e[1]}function RedBlackTree(){(this||e)._=null}function RedBlackNode(e){e.U=e.C=e.L=e.R=e.P=e.N=null}RedBlackTree.prototype={constructor:RedBlackTree,insert:function(t,r){var i,n,a;if(t){r.P=t;r.N=t.N;t.N&&(t.N.P=r);t.N=r;if(t.R){t=t.R;while(t.L)t=t.L;t.L=r}else t.R=r;i=t}else if((this||e)._){t=RedBlackFirst((this||e)._);r.P=null;r.N=t;t.P=t.L=r;i=t}else{r.P=r.N=null;(this||e)._=r;i=null}r.L=r.R=null;r.U=i;r.C=true;t=r;while(i&&i.C){n=i.U;if(i===n.L){a=n.R;if(a&&a.C){i.C=a.C=false;n.C=true;t=n}else{if(t===i.R){RedBlackRotateLeft(this||e,i);t=i;i=t.U}i.C=false;n.C=true;RedBlackRotateRight(this||e,n)}}else{a=n.L;if(a&&a.C){i.C=a.C=false;n.C=true;t=n}else{if(t===i.L){RedBlackRotateRight(this||e,i);t=i;i=t.U}i.C=false;n.C=true;RedBlackRotateLeft(this||e,n)}}i=t.U}(this||e)._.C=false},remove:function(t){t.N&&(t.N.P=t.P);t.P&&(t.P.N=t.N);t.N=t.P=null;var r=t.U,i,n=t.L,a=t.R,l,f;l=n?a?RedBlackFirst(a):n:a;r?r.L===t?r.L=l:r.R=l:(this||e)._=l;if(n&&a){f=l.C;l.C=t.C;l.L=n;n.U=l;if(l!==a){r=l.U;l.U=t.U;t=l.R;r.L=t;l.R=a;a.U=l}else{l.U=r;r=l;t=l.R}}else{f=t.C;t=l}t&&(t.U=r);if(!f)if(t&&t.C)t.C=false;else{do{if(t===(this||e)._)break;if(t===r.L){i=r.R;if(i.C){i.C=false;r.C=true;RedBlackRotateLeft(this||e,r);i=r.R}if(i.L&&i.L.C||i.R&&i.R.C){if(!i.R||!i.R.C){i.L.C=false;i.C=true;RedBlackRotateRight(this||e,i);i=r.R}i.C=r.C;r.C=i.R.C=false;RedBlackRotateLeft(this||e,r);t=(this||e)._;break}}else{i=r.L;if(i.C){i.C=false;r.C=true;RedBlackRotateRight(this||e,r);i=r.L}if(i.L&&i.L.C||i.R&&i.R.C){if(!i.L||!i.L.C){i.R.C=false;i.C=true;RedBlackRotateLeft(this||e,i);i=r.L}i.C=r.C;r.C=i.L.C=false;RedBlackRotateRight(this||e,r);t=(this||e)._;break}}i.C=true;t=r;r=r.U}while(!t.C);t&&(t.C=false)}}};function RedBlackRotateLeft(e,t){var r=t,i=t.R,n=r.U;n?n.L===r?n.L=i:n.R=i:e._=i;i.U=n;r.U=i;r.R=i.L;r.R&&(r.R.U=r);i.L=r}function RedBlackRotateRight(e,t){var r=t,i=t.L,n=r.U;n?n.L===r?n.L=i:n.R=i:e._=i;i.U=n;r.U=i;r.L=i.R;r.L&&(r.L.U=r);i.R=r}function RedBlackFirst(e){while(e.L)e=e.L;return e}function createEdge(e,t,r,i){var n=[null,null],a=o.push(n)-1;n.left=e;n.right=t;r&&setEdgeEnd(n,e,t,r);i&&setEdgeEnd(n,t,e,i);c[e.index].halfedges.push(a);c[t.index].halfedges.push(a);return n}function createBorderEdge(e,t,r){var i=[t,r];i.left=e;return i}function setEdgeEnd(e,t,r,i){if(e[0]||e[1])e.left===r?e[1]=i:e[0]=i;else{e[0]=i;e.left=t;e.right=r}}function clipEdge(e,t,r,i,n){var a=e[0],l=e[1],f=a[0],c=a[1],s=l[0],o=l[1],u=0,h=1,d=s-f,g=o-c,v;v=t-f;if(d||!(v>0)){v/=d;if(d<0){if(v<u)return;v<h&&(h=v)}else if(d>0){if(v>h)return;v>u&&(u=v)}v=i-f;if(d||!(v<0)){v/=d;if(d<0){if(v>h)return;v>u&&(u=v)}else if(d>0){if(v<u)return;v<h&&(h=v)}v=r-c;if(g||!(v>0)){v/=g;if(g<0){if(v<u)return;v<h&&(h=v)}else if(g>0){if(v>h)return;v>u&&(u=v)}v=n-c;if(g||!(v<0)){v/=g;if(g<0){if(v>h)return;v>u&&(u=v)}else if(g>0){if(v<u)return;v<h&&(h=v)}if(!(u>0)&&!(h<1))return true;u>0&&(e[0]=[f+u*d,c+u*g]);h<1&&(e[1]=[f+h*d,c+h*g]);return true}}}}}function connectEdge(e,t,r,i,n){var a=e[1];if(a)return true;var l=e[0],f=e.left,c=e.right,s=f[0],o=f[1],u=c[0],h=c[1],d=(s+u)/2,g=(o+h)/2,v,R;if(h===o){if(d<t||d>=i)return;if(s>u){if(l){if(l[1]>=n)return}else l=[d,r];a=[d,n]}else{if(l){if(l[1]<r)return}else l=[d,n];a=[d,r]}}else{v=(s-u)/(h-o);R=g-v*d;if(v<-1||v>1)if(s>u){if(l){if(l[1]>=n)return}else l=[(r-R)/v,r];a=[(n-R)/v,n]}else{if(l){if(l[1]<r)return}else l=[(n-R)/v,n];a=[(r-R)/v,r]}else if(o<h){if(l){if(l[0]>=i)return}else l=[t,v*t+R];a=[i,v*i+R]}else{if(l){if(l[0]<t)return}else l=[i,v*i+R];a=[t,v*t+R]}}e[0]=l;e[1]=a;return true}function clipEdges(e,t,r,i){var n=o.length,l;while(n--)connectEdge(l=o[n],e,t,r,i)&&clipEdge(l,e,t,r,i)&&(Math.abs(l[0][0]-l[1][0])>a||Math.abs(l[0][1]-l[1][1])>a)||delete o[n]}function createCell(e){return c[e.index]={site:e,halfedges:[]}}function cellHalfedgeAngle(e,t){var r=e.site,i=t.left,n=t.right;r===n&&(n=i,i=r);if(n)return Math.atan2(n[1]-i[1],n[0]-i[0]);r===i?(i=t[1],n=t[0]):(i=t[0],n=t[1]);return Math.atan2(i[0]-n[0],n[1]-i[1])}function cellHalfedgeStart(e,t){return t[+(t.left!==e.site)]}function cellHalfedgeEnd(e,t){return t[+(t.left===e.site)]}function sortCellHalfedges(){for(var e=0,t=c.length,r,i,n,a;e<t;++e)if((r=c[e])&&(a=(i=r.halfedges).length)){var l=new Array(a),f=new Array(a);for(n=0;n<a;++n)l[n]=n,f[n]=cellHalfedgeAngle(r,o[i[n]]);l.sort((function(e,t){return f[t]-f[e]}));for(n=0;n<a;++n)f[n]=i[l[n]];for(n=0;n<a;++n)i[n]=f[n]}}function clipCells(e,t,r,i){var n=c.length,l,f,s,u,h,d,g,v,R,C,p,B,L=true;for(l=0;l<n;++l)if(f=c[l]){s=f.site;h=f.halfedges;u=h.length;while(u--)o[h[u]]||h.splice(u,1);u=0,d=h.length;while(u<d){C=cellHalfedgeEnd(f,o[h[u]]),p=C[0],B=C[1];g=cellHalfedgeStart(f,o[h[++u%d]]),v=g[0],R=g[1];if(Math.abs(p-v)>a||Math.abs(B-R)>a){h.splice(u,0,o.push(createBorderEdge(s,C,Math.abs(p-e)<a&&i-B>a?[e,Math.abs(v-e)<a?R:i]:Math.abs(B-i)<a&&r-p>a?[Math.abs(R-i)<a?v:r,i]:Math.abs(p-r)<a&&B-t>a?[r,Math.abs(v-r)<a?R:t]:Math.abs(B-t)<a&&p-e>a?[Math.abs(R-t)<a?v:e,t]:null))-1);++d}}d&&(L=false)}if(L){var k,E,b,M=Infinity;for(l=0,L=null;l<n;++l)if(f=c[l]){s=f.site;k=s[0]-e;E=s[1]-t;b=k*k+E*E;b<M&&(M=b,L=f)}if(L){var N=[e,t],P=[e,i],w=[r,i],U=[r,t];L.halfedges.push(o.push(createBorderEdge(s=L.site,N,P))-1,o.push(createBorderEdge(s,P,w))-1,o.push(createBorderEdge(s,w,U))-1,o.push(createBorderEdge(s,U,N))-1)}}for(l=0;l<n;++l)(f=c[l])&&(f.halfedges.length||delete c[l])}var r=[];var i;function Circle(){RedBlackNode(this||e);(this||e).x=(this||e).y=(this||e).arc=(this||e).site=(this||e).cy=null}function attachCircle(e){var t=e.P,n=e.N;if(t&&n){var a=t.site,f=e.site,c=n.site;if(a!==c){var o=f[0],u=f[1],h=a[0]-o,d=a[1]-u,g=c[0]-o,v=c[1]-u;var R=2*(h*v-d*g);if(!(R>=-l)){var C=h*h+d*d,p=g*g+v*v,B=(v*C-d*p)/R,L=(h*p-g*C)/R;var k=r.pop()||new Circle;k.arc=e;k.site=f;k.x=B+o;k.y=(k.cy=L+u)+Math.sqrt(B*B+L*L);e.circle=k;var E=null,b=s._;while(b)if(k.y<b.y||k.y===b.y&&k.x<=b.x){if(!b.L){E=b.P;break}b=b.L}else{if(!b.R){E=b;break}b=b.R}s.insert(E,k);E||(i=k)}}}}function detachCircle(e){var t=e.circle;if(t){t.P||(i=t.N);s.remove(t);r.push(t);RedBlackNode(t);e.circle=null}}var n=[];function Beach(){RedBlackNode(this||e);(this||e).edge=(this||e).site=(this||e).circle=null}function createBeach(e){var t=n.pop()||new Beach;t.site=e;return t}function detachBeach(e){detachCircle(e);f.remove(e);n.push(e);RedBlackNode(e)}function removeBeach(e){var t=e.circle,r=t.x,i=t.cy,n=[r,i],l=e.P,f=e.N,c=[e];detachBeach(e);var s=l;while(s.circle&&Math.abs(r-s.circle.x)<a&&Math.abs(i-s.circle.cy)<a){l=s.P;c.unshift(s);detachBeach(s);s=l}c.unshift(s);detachCircle(s);var o=f;while(o.circle&&Math.abs(r-o.circle.x)<a&&Math.abs(i-o.circle.cy)<a){f=o.N;c.push(o);detachBeach(o);o=f}c.push(o);detachCircle(o);var u=c.length,h;for(h=1;h<u;++h){o=c[h];s=c[h-1];setEdgeEnd(o.edge,s.site,o.site,n)}s=c[0];o=c[u-1];o.edge=createEdge(s.site,o.site,null,n);attachCircle(s);attachCircle(o)}function addBeach(e){var t=e[0],r=e[1],i,n,l,c,s=f._;while(s){l=leftBreakPoint(s,r)-t;if(l>a)s=s.L;else{c=t-rightBreakPoint(s,r);if(!(c>a)){if(l>-a){i=s.P;n=s}else if(c>-a){i=s;n=s.N}else i=n=s;break}if(!s.R){i=s;break}s=s.R}}createCell(e);var o=createBeach(e);f.insert(i,o);if(i||n)if(i!==n)if(n){detachCircle(i);detachCircle(n);var u=i.site,h=u[0],d=u[1],g=e[0]-h,v=e[1]-d,R=n.site,C=R[0]-h,p=R[1]-d,B=2*(g*p-v*C),L=g*g+v*v,k=C*C+p*p,E=[(p*L-v*k)/B+h,(g*k-C*L)/B+d];setEdgeEnd(n.edge,u,R,E);o.edge=createEdge(u,e,null,E);n.edge=createEdge(e,R,null,E);attachCircle(i);attachCircle(n)}else o.edge=createEdge(i.site,o.site);else{detachCircle(i);n=createBeach(i.site);f.insert(o,n);o.edge=n.edge=createEdge(i.site,o.site);attachCircle(i);attachCircle(n)}}function leftBreakPoint(e,t){var r=e.site,i=r[0],n=r[1],a=n-t;if(!a)return i;var l=e.P;if(!l)return-Infinity;r=l.site;var f=r[0],c=r[1],s=c-t;if(!s)return f;var o=f-i,u=1/a-1/s,h=o/s;return u?(-h+Math.sqrt(h*h-2*u*(o*o/(-2*s)-c+s/2+n-a/2)))/u+i:(i+f)/2}function rightBreakPoint(e,t){var r=e.N;if(r)return leftBreakPoint(r,t);var i=e.site;return i[1]===t?i[0]:Infinity}var a=1e-6;var l=1e-12;var f;var c;var s;var o;function triangleArea(e,t,r){return(e[0]-r[0])*(t[1]-e[1])-(e[0]-t[0])*(r[1]-e[1])}function lexicographic(e,t){return t[1]-e[1]||t[0]-e[0]}function Diagram(t,r){var n=t.sort(lexicographic).pop(),a,l,u;o=[];c=new Array(t.length);f=new RedBlackTree;s=new RedBlackTree;while(true){u=i;if(n&&(!u||n[1]<u.y||n[1]===u.y&&n[0]<u.x)){if(n[0]!==a||n[1]!==l){addBeach(n);a=n[0],l=n[1]}n=t.pop()}else{if(!u)break;removeBeach(u.arc)}}sortCellHalfedges();if(r){var h=+r[0][0],d=+r[0][1],g=+r[1][0],v=+r[1][1];clipEdges(h,d,g,v);clipCells(h,d,g,v)}(this||e).edges=o;(this||e).cells=c;f=s=o=c=null}Diagram.prototype={constructor:Diagram,polygons:function(){var t=(this||e).edges;return(this||e).cells.map((function(e){var r=e.halfedges.map((function(r){return cellHalfedgeStart(e,t[r])}));r.data=e.site.data;return r}))},triangles:function(){var t=[],r=(this||e).edges;(this||e).cells.forEach((function(e,i){if(f=(a=e.halfedges).length){var n=e.site,a,l=-1,f,c,s=r[a[f-1]],o=s.left===n?s.right:s.left;while(++l<f){c=o;s=r[a[l]];o=s.left===n?s.right:s.left;c&&o&&i<c.index&&i<o.index&&triangleArea(n,c,o)<0&&t.push([n.data,c.data,o.data])}}}));return t},links:function(){return(this||e).edges.filter((function(e){return e.right})).map((function(e){return{source:e.left.data,target:e.right.data}}))},find:function(t,r,i){var n=this||e,a,l=n._found||0,f=n.cells.length,c;while(!(c=n.cells[l]))if(++l>=f)return null;var s=t-c.site[0],o=r-c.site[1],u=s*s+o*o;do{c=n.cells[a=l],l=null;c.halfedges.forEach((function(e){var i=n.edges[e],a=i.left;if(a!==c.site&&a||(a=i.right)){var f=t-a[0],s=r-a[1],o=f*f+s*s;o<u&&(u=o,l=a.index)}}))}while(null!==l);n._found=a;return null==i||u<=i*i?c.site:null}};function voronoi(){var e=x,t=y,r=null;function voronoi(i){return new Diagram(i.map((function(r,n){var l=[Math.round(e(r,n,i)/a)*a,Math.round(t(r,n,i)/a)*a];l.index=n;l.data=r;return l})),r)}voronoi.polygons=function(e){return voronoi(e).polygons()};voronoi.links=function(e){return voronoi(e).links()};voronoi.triangles=function(e){return voronoi(e).triangles()};voronoi.x=function(t){return arguments.length?(e="function"===typeof t?t:constant(+t),voronoi):e};voronoi.y=function(e){return arguments.length?(t="function"===typeof e?e:constant(+e),voronoi):t};voronoi.extent=function(e){return arguments.length?(r=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],voronoi):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]};voronoi.size=function(e){return arguments.length?(r=null==e?null:[[0,0],[+e[0],+e[1]]],voronoi):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]};return voronoi}t.voronoi=voronoi;Object.defineProperty(t,"__esModule",{value:true})}));const r=t.voronoi,i=t.__esModule;export default t;export{i as __esModule,r as voronoi};

